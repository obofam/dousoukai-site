<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>3年2組 40歳節目同窓会 ＆ 中村先生ご退職感謝の集い</title>
<style>
:root{--base:#FFB297;--accent:#FE620D;--text:#333;--card-bg:#ffffff;}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans JP",sans-serif;line-height:1.6;color:var(--text);background:var(--base);}
header{
  background:
    linear-gradient(rgba(0,0,0,0.35), rgba(0,0,0,0.35)),
    url('IMG_5731.JPG') center 20%/cover no-repeat,
    var(--base) url('hero.jpg') center/cover no-repeat;
  min-height:60vh;
  aspect-ratio: 4/3; /* 一般的な集合写真比率。必要に応じて調整可 */
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  text-shadow:0 2px 4px rgba(0,0,0,.4);
  position:relative;
  /* 上5分の1、下3分の1をパキッとカット */
  clip-path: inset(20% 0 28% 0);
  -webkit-clip-path: inset(20% 0 28% 0);
}
header h1{
  font-size:2rem;
  margin:0;
  padding:0.5em 1rem 0.3em 1rem; /* 上下余白を詰める */
  text-align:center;
  line-height:1.1;
}
section{max-width:960px;margin:2rem auto;padding:0 1rem;}
.card{background:var(--card-bg);border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);padding:1.5rem;margin-bottom:2rem;}
h2{margin-top:0;color:var(--accent);}
.timeline li{margin:0.5rem 0;}
.btn{display:inline-block;background:var(--accent);color:#fff;text-decoration:none;padding:0.8rem 1.6rem;border-radius:4px;font-weight:600;}
footer{background:var(--accent);color:#fff;text-align:center;padding:1rem 0;}
@media(min-width:600px){header h1{font-size:3rem;}}
iframe.youtube{width:100%;aspect-ratio:16/9;border:0;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);}
/* 掲示板テーブルのスタイル */
#attendance-board table{width:100%;border-collapse:collapse;}
#attendance-board th,#attendance-board td{padding:0.4rem;border-bottom:1px solid #eee;}
#attendance-board th{background:#ffe1d1;}
</style>
</head>
<body>
<header>
  <h1>3年2組 40歳節目同窓会<br>&amp; 中村先生ご退職感謝の集い</h1>
</header>

<section class="card">
  <p>拝啓　初秋の候、皆さまには益々ご清祥のこととお慶び申し上げます。<br>
  私たちが川西町立第一中学校を卒業して早二十余年――今年で節目の <strong>40歳</strong> を迎える年となりました。<br>
  この度、3年2組の同窓会を下記のとおり開催する運びとなりました。加えて、長年にわたり私たちを導いてくださった <strong>中村先生のご退職</strong> という節目も重なり、先生への感謝を込めたお祝いの会を併せて執り行いたく存じます。</p>
  <p>懐かしい仲間との再会とともに、先生と過ごすひとときをぜひご一緒いただきたく、ご案内申し上げます。<br>
  ご多用中とは存じますが、万障お繰り合わせのうえ、ご出席賜りますようお願いいたします。</p>
  <p style="text-align:right;">令和７年７月吉日<br>3年2組同窓会 幹事長　本間　翼</p>
</section>

<section class="card">
  <h2>開催概要</h2>
  <p><strong>日時：</strong>2025年9月21日（日）</p>
  <ul class="timeline">
    <li>15:45　皇大神社 集合</li>
    <li>16:00　ご祈祷（健康祈願・前厄のお祓い）</li>
    <li>16:30　記念写真撮影 → 各自移動</li>
    <li>17:00　同窓会 &amp; 祝賀会 開宴（2時間飲み放題）</li>
    <li>18:00　サプライズ合唱・記念品贈呈</li>
    <li>19:00　中締め</li>
  </ul>
  <p><strong>場所：</strong>皇大神社 ／ キッチン＆バー カリスマ</p>
  <p><strong>会費：</strong>10,000円（予定）</p>
</section>

<section class="card">
  <h2>同窓会出欠確認フォーム</h2>
  <iframe data-tally-src="https://tally.so/embed/w4l19O?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" loading="lazy" width="100%" height="540" frameborder="0" marginheight="0" marginwidth="0" title="同窓会出欠確認フォーム"></iframe>
</section>
<script>
var d=document,w="https://tally.so/widgets/embed.js",v=function(){"undefined"!=typeof Tally?Tally.loadEmbeds():d.querySelectorAll("iframe[data-tally-src]:not([src])").forEach((function(e){e.src=e.dataset.tallySrc}))};if("undefined"!=typeof Tally)v();else if(d.querySelector('script[src="'+w+'"]')==null){var s=d.createElement("script");s.src=w,s.onload=v,s.onerror=v,d.body.appendChild(s);}
</script>

<section class="card">
  <h2>ご協力のお願い</h2>
  <ul>
    <li>写真や思い出エピソードを募集中です。</li>
    <li>欠席者は先生へのメッセージ動画を8月末までにお送りください。</li>
    <li>当日は「十字架（クルス）の島」を合唱予定。歌詞カードは会場で配布します。</li>
  </ul>
</section>

<section class="card">
  <h2>合唱曲「十字架（クルス）の島」復習用動画</h2>
  <p>当日までにサビだけでも思い出しておいてね♪</p>
  <iframe class="youtube" src="https://www.youtube.com/embed/kNbZyzZiBIE" allowfullscreen></iframe>
</section>

<footer>
  幹事長：本間 翼&nbsp;|&nbsp;お問い合わせ：090-8780-4461
</footer>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxENDno0Keg_L8JVKPGn273qnh1lZv7y0wP3nh9bGn_LXPxDJw4fqWN-YqEC3Lnk2Jo5g/exec";

async function fetchAttendance() {
  const board = document.getElementById('attendance-board');
  board.innerHTML = "<p>読み込み中...</p>";
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error("データ形式エラー");
    if (data.length === 0) {
      board.innerHTML = "<p>まだ投稿がありません。</p>";
      return;
    }
    let html = '<table><thead><tr><th>名前</th><th>出欠</th><th>コメント</th><th>投稿日時</th></tr></thead><tbody>';
    for (const row of data.reverse()) {
      html += `<tr>
        <td>${row.name ? escapeHtml(row.name) : ""}</td>
        <td>${row.attendance ? escapeHtml(row.attendance) : ""}</td>
        <td>${row.comment ? escapeHtml(row.comment) : ""}</td>
        <td style='font-size:0.85em;'>${row.timestamp ? formatDate(row.timestamp) : ""}</td>
      </tr>`;
    }
    html += '</tbody></table>';
    board.innerHTML = html;
  } catch (e) {
    board.innerHTML = "<p>掲示板の取得に失敗しました。</p>";
  }
}

function escapeHtml(str) {
  return String(str).replace(/[&<>"'`=\/]/g, function(s) {
    return ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;',
      "'": '&#39;', '`': '&#x60;', '=': '&#x3D;', '/': '&#x2F;'
    })[s];
  });
}

function formatDate(dateStr) {
  const date = new Date(dateStr);
  if (isNaN(date)) return dateStr;
  return `${date.getFullYear()}/${date.getMonth()+1}/${date.getDate()} ${date.getHours().toString().padStart(2,"0")}:${date.getMinutes().toString().padStart(2,"0")}`;
}

document.getElementById('attendance-form').addEventListener('submit', async function(e){
  e.preventDefault();
  const form = e.target;
  const name = form.name.value.trim();
  const attendance = form.attendance.value;
  const comment = form.comment.value.trim();
  if (!name || !attendance) {
    alert('名前と出欠は必須です');
    return;
  }
  try {
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({name, attendance, comment}),
      headers: {"Content-Type": "application/json"}
    });
    const result = await res.json();
    if(result.result === "success"){
      form.reset();
      fetchAttendance();
      alert("送信しました。掲示板に反映されます。");
    } else {
      alert("送信に失敗しました。");
    }
  } catch (e) {
    alert("送信時にエラーが発生しました。");
  }
});

// 初回表示＆60秒ごとに自動更新
fetchAttendance();
setInterval(fetchAttendance, 60000);
</script>
</body>
</html>
